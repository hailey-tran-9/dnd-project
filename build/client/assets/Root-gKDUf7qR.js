import{y as E,a as h,t as e,z as l,v as $,O as q}from"./chunk-ZYFC6VSF-CcTFIW6Y.js";import{u as R,a as D}from"./react-redux-DItQxzwd.js";import{g as k,o as p,r as c,q as G,e as C,a as S,b as z,u as I}from"./index.esm2017-BgJZ7Iac.js";import{g as B,o as L,s as F}from"./index-35c79a8a-B373Vm6L.js";import"./index.esm2017-T8jfeyBt.js";import{a as d}from"./user-slice-CHAln-Bf.js";import{s as Q,a as y,b as U,d as A}from"./Navbar.module-Bd2FxbWW.js";import{B as M}from"./Button-DRBTarQj.js";import{T as H}from"./Toasts-Cc5nLbJ6.js";import"./redux-toolkit.modern-lSMJCofG.js";import"./toasts-slice-DTwqLh1O.js";import"./v4-C6aID195.js";function J(){const f=B(),a=k(),t=R(),v=E(),i=D(r=>r.user.loginStatus),n=D(r=>r.user.username),g=D(r=>r.user.pfpURL),u=h.useRef(null),[b,o]=h.useState(!1),[s,j]=h.useState(!0);h.useEffect(()=>{L(f,O=>{O?i||(t(d.signInUser()),p(c(a,"users/users/"+O.uid+"/public"),T=>{const N=T.val();N&&(t(d.updateUsername(N.username)),t(d.updateStatusMessage(N.statusMessage)),t(d.updatePfpURL(O.photoURL)))})):i&&t(d.signOutUser())});const r=setTimeout(()=>j(!1),700);return()=>clearTimeout(r)},[]),h.useEffect(()=>{b&&x()},[v]);function x(){const r=!b;o(r),r?u.current.showModal():u.current.close()}function w(){F(f).then(()=>{u.current.close(),t(d.signOutUser()),console.log("user has been signed out")}).catch(r=>{console.log("error trying to sign the user out")})}let m=e.jsx("button",{onClick:x,className:"cursor-pointer",children:g?e.jsx("img",{src:g,className:"size-15 object-cover object-center rounded-full"}):e.jsx("div",{className:"size-15 object-cover object-center rounded-full bg-white"})}),P=e.jsx(l,{to:"/signin",children:e.jsx(M,{children:"Sign In"})});return e.jsxs(e.Fragment,{children:[e.jsx("dialog",{id:"userActionsBarDiv",ref:u,className:"max-w-full max-h-full w-full h-full bg-black/40",children:e.jsxs("div",{className:"fixed w-[60vw] lg:w-[30vw] 2xl:w-[40vw] h-full inset-y-0 right-0 flex flex-col bg-white text-black text-[1.5rem] px-10 py-7",children:[e.jsxs("div",{className:"flex flex-row justify-between text-center gap-5 mb-7",children:[e.jsx("h3",{className:"text-[2rem] text-nowrap overflow-auto",children:n}),e.jsx("button",{onClick:x,className:"text-4xl text-gray-300 hover:text-gray-700",children:"x"})]}),e.jsx(l,{to:"/help",children:e.jsx("button",{className:"w-full text-start hover:bg-neutral-50 px-5 py-1 rounded-md",children:"Help"})}),e.jsx(l,{to:f.currentUser&&"/users/"+f.currentUser.uid,children:e.jsx("button",{className:"w-full text-start hover:bg-neutral-50 px-5 py-1 rounded-md",children:"Profile"})}),e.jsx(l,{to:"/settings",children:e.jsx("button",{className:"w-full text-start hover:bg-neutral-50 px-5 py-1 rounded-md",children:"Settings"})}),e.jsx("hr",{className:"border-neutral-300 mb-7 mt-auto"}),e.jsx(l,{to:"/",onClick:w,children:e.jsx(M,{className:"w-full",children:"Sign Out"})})]})}),e.jsxs("div",{id:Q.navbar,className:"flex flex-row justify-between px-10 py-5 2xl:px-15 sm:py-2 md:py-3 items-center flex-wrap border-b border-b-white/20",children:[e.jsx("div",{className:"flex flex-row gap-7 xl:gap-12 items-center",children:i?e.jsxs(e.Fragment,{children:[e.jsx(l,{to:"/",children:e.jsx("h1",{className:"mr-10",children:"dnd"})}),e.jsx(l,{to:"/characters",className:"hover:text-neutral-200",children:e.jsx("h3",{children:"Characters"})}),e.jsx(l,{to:"/games",className:"hover:text-neutral-200",children:e.jsx("h3",{children:"Games"})}),e.jsx(l,{to:"/maps",className:"hover:text-neutral-200",children:e.jsx("h3",{children:"Maps"})})]}):e.jsx("h1",{className:"mr-10",children:"dnd"})}),!s&&(i?m:P)]})]})}const ne=$(function(){const a=R(),t=k(),v=B();return h.useEffect(()=>{L(v,i=>{if(i){const n=i.uid,g=G(c(t,"characters/characters"),S("userID"),C(n));p(g,o=>{const s=o.val();a(s?U.loadCharacters({characters:s||{},numberOfCharacters:Object.keys(s).length||0}):U.loadCharacters({characters:{},numberOfCharacters:0}))});const u=G(c(t,"games/games"),S("userID"),C(n));p(u,o=>{const s=o.val();a(s?y.loadGames({games:s||{},numberOfGames:Object.keys(s).length||0}):y.loadGames({games:{},numberOfGames:0}))}),p(c(t,"users/users/"+n+"/public/joinedGames"),o=>{const s=o.val();if(s)for(const[j,x]of Object.entries(s))z(c(t,"games/games/"+x)).then(w=>{const m=w.val();m?m.hasOwnProperty("playersInGame")&&m.playersInGame.hasOwnProperty(n)?a(y.loadAJoinedGame(m)):I(c(t),{[`users/users/${n}/public/joinedGames/${j}`]:null}):I(c(t),{[`users/users/${n}/public/joinedGames/${j}`]:null})})});const b=G(c(t,"maps/maps"),S("userID"),C(n));p(b,o=>{const s=o.val();a(s?A.loadMaps({maps:s||{},numberOfMaps:Object.keys(s).length||0}):A.loadMaps({maps:{},numberOfMaps:0}))})}else a(y.loadGames({games:{},numberOfGames:0})),a(U.loadCharacters({characters:{},numberOfCharacters:0})),a(A.loadMaps({maps:{},numberOfMaps:0}))})},[a]),e.jsxs(e.Fragment,{children:[e.jsx(J,{}),e.jsx(H,{}),e.jsx(q,{})]})});async function oe(){return{title:"Root Layout"}}export{oe as clientLoader,ne as default};
