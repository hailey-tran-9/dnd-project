import{w as R,x as T,z as k,a as d,t as s}from"./chunk-ZYFC6VSF-YzFXoqaq.js";import{g as U,s as q}from"./index-35c79a8a-DCN24IeX.js";import"./index.esm2017-l84fuskm.js";import{g as B,q as p,e as x,a as j,r as o,b as g,u as i,i as h}from"./index.esm2017-CGYb_oOY.js";import{u as M}from"./react-redux-CX7JyCt4.js";import{a as Q}from"./user-slice-BAhfNq2U.js";import{B as b}from"./Button-B_obNlYv.js";import"./redux-toolkit.modern-gsldsko2.js";const V=R(function(){const D=U(),t=B(),v=T(),y=k(),O=M(),u=d.useRef(null),[w,N]=d.useState(!1);d.useEffect(()=>{w&&f()},[v]);function f(){const n=!w;N(n),n?u.current.showModal():u.current.close()}function C(){q(D).then(()=>{u.current.close(),O(Q.signOutUser()),console.log("user has been signed out FROM THE SETTINGS PAGE"),y("/")}).catch(n=>{console.log("error trying to sign the user out")})}function I(){const n=D.currentUser;if(n){const c=n.uid,A=p(o(t,"characters/characters"),j("userID"),x(c));g(A).then(a=>{const e=a.val();if(console.log(e),e)for(const[r,m]of Object.entries(e))i(o(t),{["characters/characters/"+r]:null,"characters/numberOfCharacters":h(-1)}).catch(l=>{console.log("error deleting the user's characters from the db"),console.log(l.message)})});const S=p(o(t,"games/games"),j("userID"),x(c));g(S).then(a=>{const e=a.val();if(console.log(e),e)for(const[r,m]of Object.entries(e))console.log(r),i(o(t),{["games/games/"+r]:null,"games/numberOfGames":h(-1)}).catch(l=>{console.log("error deleting the user's games from the db"),console.log(l.message)})});const G=o(t,`users/users/${c}/public/joinedGames`);g(G).then(a=>{const e=a.val();console.log("joined games data"),console.log(e),e&&Object.values(e).map(r=>{i(o(t),{[`games/games/${r}/playersInGame/${c}`]:null}).catch(m=>{console.log("error deleting a user and removing them from the games they joined"),console.log(m.message)})})});const E=p(o(t,"maps/maps"),j("userID"),x(c));g(E).then(a=>{const e=a.val();if(console.log(e),e)for(const[r,m]of Object.entries(e))i(o(t),{["maps/maps/"+r]:null,"maps/numberOfMaps":h(-1)}).catch(l=>{console.log("error deleting the user's maps from the db"),console.log(l.message)})}),i(o(t),{["users/users/"+c]:null,"users/numberOfUsers":h(-1)}).catch(a=>{console.log("error deleting the user's info from the db"),console.log(a.message)}),C()}}return s.jsxs(s.Fragment,{children:[s.jsx("dialog",{id:"deleteAccountConfirmation",ref:u,className:"max-w-full max-h-full w-full h-full bg-black/40",children:s.jsx("div",{className:"flex w-full h-full justify-center items-center text-center text-pretty",children:s.jsxs("div",{className:"w-[40vw] h-fit bg-white px-5 py-10 rounded-2xl",children:[s.jsx("p",{className:"mb-7",children:"Are you sure you want to delete this account?"}),s.jsxs("div",{className:"flex flex-row w-full justify-around",children:[s.jsx(b,{onClick:I,className:"w-[30%]",children:"Yes"}),s.jsx(b,{onClick:f,className:"w-[30%]",children:"No"})]})]})})}),s.jsxs("div",{className:"p-32 xl:px-[20vw]",children:[s.jsx("h1",{className:"mb-10",children:"Settings"}),s.jsx("div",{className:"w-fit flex flex-col gap-30",children:s.jsx(b,{onClick:f,children:"Delete Account"})})]})]})});export{V as default};
