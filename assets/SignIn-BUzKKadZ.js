import{w as S,z as A,a as K,t as e,A as O,y as v}from"./chunk-ZYFC6VSF-YzFXoqaq.js";import{u as F}from"./react-redux-CX7JyCt4.js";import{g as U,e as L,s as M,u as q}from"./index-35c79a8a-DCN24IeX.js";import"./index.esm2017-l84fuskm.js";import{g as B,r as j,b as R,d as T,u as z,i as G}from"./index.esm2017-CGYb_oOY.js";import{a as d}from"./user-slice-BAhfNq2U.js";import{b as V,v as W}from"./util-BtYTE4DC.js";import{t as c}from"./Toasts--U34NDwv.js";import{I}from"./Input-BmhOrzRe.js";import{B as u}from"./Button-B_obNlYv.js";import{v as H}from"./v4-C6aID195.js";import"./redux-toolkit.modern-gsldsko2.js";import"./toasts-slice-CJ4y-2PB.js";const ie=S(function(){const s=F(),p=U(),N=A(),f=B();K.useEffect(()=>(s(d.startSignIn()),()=>{s(d.stopSignIn())}),[s]);const g=window.crypto.subtle||window.crypto.webkitSubtle;async function E(){return await g.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"])}async function h(t){return await g.exportKey("jwk",t)}async function P(t){t.preventDefault();const x=new FormData(t.target),y=Object.fromEntries(x),b=y["entered-email"];if(!V(b)){console.log("make sure you've entered a valid email"),s(c("Error","Please enter a valid email."));return}const w=y["entered-password"];if(!W(w)){console.log("not a valid password"),s(c("Error","Please enter a valid password. (7-12 characters/at least 1 lowercase and uppercase letter, number, and non-alphanumeric character)"));return}L(p,b,w).then(o=>{const r=o.user,l=r.uid;if(!r.emailVerified)console.log("user email hasn't been verified"),s(c("Error","User email hasn't been verified yet.")),M(p).then(()=>{console.log("successfully signed out")}).catch(a=>{const m=a.code,i=a.message;console.log("error signing out"),console.log(m,i)});else{s(d.signInUser());const a=j(f,"users/users/"+l);R(a).then(m=>{if(!m.exists()){const i=H();q(r,{displayName:i}).catch(n=>{console.log("error setting a random display name for the new user"),console.log(n.message)}),E().then(n=>{h(n.publicKey).then(C=>{h(n.privateKey).then(k=>{n&&T(a,{public:{key:C,username:i},private:{characters:{characterIDs:{},numberOfCharacters:0},games:{gameIDs:{},numberOfGames:0},key:k,maps:{mapIDs:{},numberOfMaps:0}}}).then(()=>{z(j(f),{"users/numberOfUsers":G(1)})}).catch(D=>{console.log("error creating the user in the db"),console.log(D.message)})})})})}}),N("/")}}).catch(o=>{const r=o.code,l=o.message;console.log("error trying to sign in"),console.log(r,l),s(c("Error","Login information is incorrect. Try again."))})}return e.jsx("div",{className:"flex flex-grow bg-[#f8eedf] text-center justify-center items-center",children:e.jsx(O,{onSubmit:t=>P(t),children:e.jsxs("div",{className:"flex flex-col items-start gap-5",children:[e.jsx("h1",{children:"Sign In"}),e.jsxs("div",{className:"flex flex-col text-start gap-1",children:[e.jsx("label",{htmlFor:"entered-email",className:"text-black text-[1.6rem] font-semibold",children:"Email"}),e.jsx(I,{id:"entered-email",name:"entered-email",type:"text",className:"w-100 text-md",required:!0})]}),e.jsxs("div",{className:"flex flex-col text-start gap-1",children:[e.jsx("label",{htmlFor:"entered-password",className:"text-black text-[1.6rem] font-semibold",children:"Password"}),e.jsx(I,{id:"entered-password",name:"entered-password",type:"password",className:"w-100 text-md",autoComplete:"off",required:!0})]}),e.jsxs("div",{className:"flex flex-row w-full justify-between gap-20 mt-10",children:[e.jsx(v,{to:"/account-creation",className:"rounded-xl",children:e.jsx(u,{type:"button",children:"Create account"})}),e.jsxs("div",{className:"flex gap-5",children:[e.jsx(v,{to:"/",className:"rounded-xl",children:e.jsx(u,{type:"button",children:"Cancel"})}),e.jsx(u,{children:"Enter"})]})]})]})})})});async function ce(){return{title:"Sign In Page"}}export{ce as clientLoader,ie as default};
